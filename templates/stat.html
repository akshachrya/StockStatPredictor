{%extends "layout.html"%}
{%block stat%}


<button type="button" class="btn btn-secondary btn-rounded btn-fw">Beta Analysis/ Volatility</button>
<button type="button" class="btn btn-warning btn-rounded btn-fw">Beta:  {{beta['beta']}}</button>
<button type="button" class="btn btn-warning btn-rounded btn-fw">{{beta['interpretation']}}</button>
     <div class="row">
         


        <select class="form-control" id="timeSelect">
              {% for label in labels %}
                <option value={{label}}>{{label}}</option>
            {% endfor %}
                                    
          </select>
          <br>
          <br>
            <div class="col-lg-4 d-flex flex-column">

             <div class="row flex-grow">
                <div class="col-12 grid-margin stretch-card">
                  <div class="card card-rounded">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-lg-12">
                          <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                              <h4 class="card-title card-title-dash"><img src="/static/promoters.png" height="50" width="50">&nbsp;&nbsp;Alike Stock</h4>
                            </div>
                          </div>
                            
                          <div class="mt-3">
                              <div id="promoters"></div>
                          
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>


           <div class="col-lg-4 d-flex flex-column">
             <div class="row flex-grow">
                <div class="col-12 grid-margin stretch-card">
                  <div class="card card-rounded">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-lg-12">
                          <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                              <h4 class="card-title card-title-dash"><img src="/static/neutral.png" height="50" width="50">&nbsp;&nbsp;Neutral Stock</h4>
                            </div>
                          </div>
                          <div class="mt-3">
                          <div id="neutrals"></div>
                          
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

           <div class="col-lg-4 d-flex flex-column">
             <div class="row flex-grow">
                <div class="col-12 grid-margin stretch-card">
                  <div class="card card-rounded">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-lg-12">
                          <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                              <h4 class="card-title card-title-dash"><img src="/static/detractor.png" height="50" width="50">&nbsp;&nbsp;unlike Stock</h4>
                            </div>
                          </div>
                          <div class="mt-3">
                            <div id="detractors"></div>
                          
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>




                    </div>
     

  <script src="https://code.highcharts.com/stock/highstock.js"></script>
  <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/stock/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/stock/modules/accessibility.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script type="text/javascript">
    var ticker = "{{ company_dict['Ticker'] }}";
      console.log("Ticker:", ticker);
      var maindata;

      function filterData(timeFrame,data) {
        let filteredData = {};
        for (let sentiment in data) {
            filteredData[sentiment] = {};
            for (let key in data[sentiment]) {
                if (key==timeFrame) {
                  filteredData[sentiment][key] = data[sentiment][key].filter(item => item[timeFrame] !== undefined);
                }
                
            }
        }
        return filteredData;
    }

      $('#timeSelect').change(function() {
                // Get the selected value
                var selectedValue = $(this).val();
                let filteredData = filterData(selectedValue,maindata);
                console.log(filteredData);
                var htmlpromoters=""
                var promotersdata= filteredData['pos'];
                var promotersdata=promotersdata[selectedValue];
                // promotershtml
                for (let i = 0; i < promotersdata.length; i++) {
                    var company=promotersdata[i];
                    htmlpromoters+='<div class="wrapper d-flex align-items-center justify-content-between py-2 border-bottom">'+
                            '<div class="d-flex">'+
                              '<div class="wrapper ms-3">'+
                                '<p class="ms-1 mb-1 fw-bold"><a target="_blank" href="'+'/'+company['Company']+'">'+company['Company']+'</a></p>'+
                              '</div>'+
                            '</div>'+
                            '<div class="text-muted text-small">'+
                            company[selectedValue]+
                            '</div></div>';

                  }

                $('#promoters').html(htmlpromoters);


                var htmlneutral=""
                var neutraldata= filteredData['neutral'];
                var neutraldata=neutraldata[selectedValue];
                for (let i = 0; i < neutraldata.length; i++) {
                    var company=neutraldata[i];
                    htmlneutral+='<div class="wrapper d-flex align-items-center justify-content-between py-2 border-bottom">'+
                            '<div class="d-flex">'+
                              '<div class="wrapper ms-3">'+
                                '<p class="ms-1 mb-1 fw-bold"><a target="_blank" href="'+'/'+company['Company']+'">'+company['Company']+'</a></p>'+
                              '</div>'+
                            '</div>'+
                            '<div class="text-muted text-small">'+
                            company[selectedValue]+
                            '</div></div>';

                  }
          

                $('#neutrals').html(htmlneutral);


                var htmldetractors=""
                var detractorsdata= filteredData['neg'];
                var detractorsdata=detractorsdata[selectedValue];
                for (let i = 0; i < detractorsdata.length; i++) {
                    var company=detractorsdata[i];
                    htmldetractors+='<div class="wrapper d-flex align-items-center justify-content-between py-2 border-bottom">'+
                            '<div class="d-flex">'+
                              '<div class="wrapper ms-3">'+
                                '<p class="ms-1 mb-1 fw-bold"><a target="_blank" href="'+'/'+company['Company']+'">'+company['Company']+'</a></p>'+
                              '</div>'+
                            '</div>'+
                            '<div class="text-muted text-small">'+
                            company[selectedValue]+
                            '</div></div>';

                  }
          

                $('#detractors').html(htmldetractors);

            });
     $(document).ready(function(){
            $.ajax({
                url: '/correlation',
                data: {
                  ticker: ticker
                 },
                success: function(data) {
                  maindata=data
                  
                  let filteredData = filterData("Overall",maindata);
                  console.log(filteredData);
                  var htmlpromoters=""
                  var promotersdata= filteredData['pos'];
                  var promotersdata=promotersdata["Overall"];
                  // promotershtml
                  for (let i = 0; i < promotersdata.length; i++) {
                      var company=promotersdata[i];
                      htmlpromoters+='<div class="wrapper d-flex align-items-center justify-content-between py-2 border-bottom">'+
                              '<div class="d-flex">'+
                                '<div class="wrapper ms-3">'+
                                   '<p class="ms-1 mb-1 fw-bold"><a target="_blank" href="'+'/'+company['Company']+'">'+company['Company']+'</a></p>'+
                                '</div>'+
                              '</div>'+
                              '<div class="text-muted text-small">'+
                              company['Overall']+
                              '</div></div>';

                    }

                  $('#promoters').html(htmlpromoters);


                  var htmlneutral=""
                  var neutraldata= filteredData['neutral'];
                  var neutraldata=neutraldata["Overall"];
                  for (let i = 0; i < neutraldata.length; i++) {
                      var company=neutraldata[i];
                      htmlneutral+='<div class="wrapper d-flex align-items-center justify-content-between py-2 border-bottom">'+
                              '<div class="d-flex">'+
                                '<div class="wrapper ms-3">'+
                                   '<p class="ms-1 mb-1 fw-bold"><a target="_blank" href="'+'/'+company['Company']+'">'+company['Company']+'</a></p>'+
                                '</div>'+
                              '</div>'+
                              '<div class="text-muted text-small">'+
                              company['Overall']+
                              '</div></div>';

                    }
            

                  $('#neutrals').html(htmlneutral);


                   var htmldetractors=""
                  var detractorsdata= filteredData['neg'];
                  var detractorsdata=detractorsdata["Overall"];
                  for (let i = 0; i < detractorsdata.length; i++) {
                      var company=detractorsdata[i];
                      htmldetractors+='<div class="wrapper d-flex align-items-center justify-content-between py-2 border-bottom">'+
                              '<div class="d-flex">'+
                                '<div class="wrapper ms-3">'+
                                  '<p class="ms-1 mb-1 fw-bold"><a target="_blank" href="'+'/'+company['Company']+'">'+company['Company']+'</a></p>'+
                                '</div>'+
                              '</div>'+
                              '<div class="text-muted text-small">'+
                              company['Overall']+
                              '</div></div>';

                    }
            

                  $('#detractors').html(htmldetractors);

                }
            });

        });
  



</script>

{%endblock%}